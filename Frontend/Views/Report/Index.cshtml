@using Assignmen_PRN232__.Dto
@model NewsArticleReportDto

@{
    ViewData["PageTitle"] = "Report & Statistics";
    var categoryId = ViewBag.CategoryId ?? 0;
    var authorId = ViewBag.AuthorId ?? 0;
    var status = ViewBag.Status;
    var fromDate = ViewBag.FromDate;
    var toDate = ViewBag.ToDate;
    var categories = (List<CategoryDto>?)ViewBag.Categories ?? new List<CategoryDto>();
    var authors = (List<SystemAccountDto>?)ViewBag.Authors ?? new List<SystemAccountDto>();
}

<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-md-6">
            <h2><i class="bi bi-bar-chart-line"></i> Report & Statistics</h2>
        </div>
    </div>

    <!-- Filter Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form asp-action="Index" method="get" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Category</label>
                    <select name="categoryId" class="form-select">
                        <option value="0">All Categories</option>
                        @foreach (var cat in categories)
                        {
                            <option value="@cat.CategoryId" selected="@(categoryId == cat.CategoryId)">@cat.CategoryName</option>
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Author</label>
                    <select name="authorId" class="form-select">
                        <option value="0">All Authors</option>
                        @foreach (var author in authors)
                        {
                            <option value="@author.AccountId" selected="@(authorId == author.AccountId)">@author.AccountName</option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select">
                        <option value="">All</option>
                        <option value="true" selected="@(status == true)">Active</option>
                        <option value="false" selected="@(status == false)">Inactive</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">From Date</label>
                    <input type="date" name="fromDate" value="@(fromDate?.ToString("yyyy-MM-dd"))" class="form-control">
                </div>
                <div class="col-md-2">
                    <label class="form-label">To Date</label>
                    <input type="date" name="toDate" value="@(toDate?.ToString("yyyy-MM-dd"))" class="form-control">
                </div>
                <div class="col-md-12 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-search"></i> Filter
                    </button>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                    </a>
                </div>
            </form>
        </div>
    </div>

    @if (Model != null)
    {
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">Total Articles</h5>
                        <h2 class="mb-0">@Model.TotalArticles</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">Active Articles</h5>
                        <h2 class="mb-0">@Model.TotalActive</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-danger">
                    <div class="card-body">
                        <h5 class="card-title">Inactive Articles</h5>
                        <h2 class="mb-0">@Model.TotalInactive</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Statistics -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Statistics by Category</h5>
            </div>
            <div class="card-body">
                @if (Model.CategoryStats.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Category</th>
                                    <th class="text-end">Total Articles</th>
                                    <th class="text-end">Active</th>
                                    <th class="text-end">Inactive</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var stat in Model.CategoryStats)
                                {
                                    <tr>
                                        <td>@stat.CategoryName</td>
                                        <td class="text-end"><strong>@stat.ArticleCount</strong></td>
                                        <td class="text-end"><span class="badge bg-success">@stat.ActiveCount</span></td>
                                        <td class="text-end"><span class="badge bg-danger">@stat.InactiveCount</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted text-center">No data available</p>
                }
            </div>
        </div>

        <!-- Author Statistics -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Statistics by Author</h5>
            </div>
            <div class="card-body">
                @if (Model.AuthorStats.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Author</th>
                                    <th class="text-end">Total Articles</th>
                                    <th class="text-end">Active</th>
                                    <th class="text-end">Inactive</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var stat in Model.AuthorStats)
                                {
                                    <tr>
                                        <td>@stat.AuthorName</td>
                                        <td class="text-end"><strong>@stat.ArticleCount</strong></td>
                                        <td class="text-end"><span class="badge bg-success">@stat.ActiveCount</span></td>
                                        <td class="text-end"><span class="badge bg-danger">@stat.InactiveCount</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted text-center">No data available</p>
                }
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> No data available. Please adjust your filters.
        </div>
    }
</div>
